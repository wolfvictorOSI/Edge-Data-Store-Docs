<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Egress from Edge Data Store </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Egress from Edge Data Store ">
    <meta name="generator" content="docfx 2.43.2.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../V1/index.html" width="46">
                <img id="logo" src="../../V1/images/atlas_icon.png" height="46" width="46" alt="OSIsoft Edge System"> 
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="egress">
<h1 id="egress-from-edge-data-store">Egress from Edge Data Store</h1>

<p>Edge Data Store provides an egress mechanism to copy and transfer data to another device or destination. Data is transferred through OMF. Supported destinations are OSIsoft Cloud Services or a PI Server.</p>
<p>Configuration of egress includes specifying zero or more endpoints. An egress endpoint represents a destination to which data will be sent. Each egress endpoint is comprised of the properties specified in the <a href="#Parameters">Parameters</a> section. It is executed independently of all other egress endpoints, and is expected to accept OMF messages. More than one endpoint for the same destination is allowed.</p>
<blockquote><p><strong>Note:</strong> Some types, and consequently containers and data, cannot be egressed. For more information, see <a href="#egress-execution-details">Egress Execution Details</a>.</p>
</blockquote>
<p>One tenant and two namespaces are supported in the Edge Data Store. The tenant is default, and the two namespaces are default (where adapter and OMF data is written) and diagnostics. Diagnostics is where the system and its components write information that can be used locally or egressed to a remote PI server or OCS for monitoring. To egress both namespaces two egress definitions are required.</p>
<h2 id="configuration">Configuration</h2>
<p>Prior to configuring egress on the Edge Data Store, follow <a href="#destination-preparation">Destination Preparation</a> steps to make available one or more OMF destinations.</p>
<h3 id="procedure">Procedure</h3>
<blockquote><p><strong>Note:</strong> You cannot add egress configurations manually, because some parameters are stored to disk encrypted. You must use the REST endpoints to add/edit egress configuration. For additional endpoints, see <a href="#rest-urls">REST Urls</a>.</p>
</blockquote>
<p>Complete the following to create new egress endpoints:</p>
<ol>
<li>Using any text editor, create a file that contains one or more egress endpoints in JSON form<ul>
<li>For content structure, see the following <a href="#Examples">Examples</a>. </li>
<li>For a table of all available egress parameters, see <a href="#Parameters">Parameters</a>.</li>
</ul>
</li>
<li>Save the file.</li>
<li>Use any tool capable of making HTTP requests to execute a POST command with the contents of that file to the following endpoint: <code>http://localhost:5590/api/v1/configuration/storage/periodicegressendpoints/</code></li>
</ol>
<ul>
<li>Example using cURL:</li>
</ul>
<pre><code class="lang-bash">curl -v -d &quot;@Storage_PeriodicEgressEndspoints.config.json&quot; -H &quot;Content-Type: application/json&quot; -X POST &quot;http://localhost:5590/api/v1/configuration/storage/periodicegressendpoints&quot;
</code></pre><h3 id="parameters">Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Enabled</strong></td>
<td>Optional</td>
<td>bool</td>
<td>An indicator of whether egress is enabled when the egress endpoint is loaded. Defaults to true.</td>
</tr>
<tr>
<td><strong>Backfill</strong></td>
<td>Optional</td>
<td>bool</td>
<td>An indicator of whether data should be backfilled. Backfilling will occur when the egress endpoint is run for the first time after application startup. Enabling backfilling will result in all data from the earliest index to the latest stored index being egressed, after applying the egress filter. Defaults to false.</td>
</tr>
<tr>
<td><strong>ValidateEndpointCertificate</strong></td>
<td>Optional</td>
<td>bool</td>
<td>Used to disable verification of destination certificate. Use for testing only with self-signed certificates. Defaults to true.</td>
</tr>
<tr>
<td><strong>EgressFilter</strong></td>
<td>Optional</td>
<td>string</td>
<td>A filter used to determine which streams and types are egressed. For more information on valid filters, see <a href="../SDS/Searching.html">Searching</a>.</td>
</tr>
<tr>
<td><strong>StreamPrefix</strong></td>
<td>Optional</td>
<td>string</td>
<td>Prefix applied to any streams that are egressed. A null string or a string containing only empty spaces will be ignored. The following restricted characters will not be allowed: / : ? # [ ] @ ! $ &amp; &#39; ( ) \ * + , ; = %</td>
</tr>
<tr>
<td><strong>TypePrefix</strong></td>
<td>Optional</td>
<td>string</td>
<td>Prefix applied to any types that are egressed. A null string or a string containing only empty spaces will be ignored. The following restricted characters will not be allowed: / : ? # [ ] @ ! $ &amp; &#39; ( ) \ * + , ; = %</td>
</tr>
<tr>
<td><strong>DebugExpiration</strong></td>
<td>Optional</td>
<td>string</td>
<td>A property that enables persistence of detailed information, for each outbound HTTP request pertaining to this egress endpoint, to disk. The value of this property represents the date and time this detailed information should stop being persisted. For more information, see <a href="../Troubleshooting/Troubleshooting.html">Troubleshooting</a>.</td>
</tr>
</tbody>
</table>
<p>=======
| <strong>EgressFilter</strong>                | Optional                  | string    | A filter used to determine which streams and types are egressed. See <a href="../SDS/Searching.html">Searching</a> for more information on valid filters. |
| <strong>Enabled</strong>                     | Optional                  | bool      | An indicator of whether egress is enabled when the egress endpoint is loaded. Defaults to true. |
| <strong>Endpoint</strong>                    | Required                  | string    | Destination that accepts OMF v1.1 messages. Supported destinations include OCS and PI. |
| <strong>ExecutionPeriod</strong>             | Required                  | string    | Frequency of time between each egress action. Must be a string in the following format d.hh:mm:ss.## |
| <strong>Id</strong>                          | Optional                  | string    | Unique identifier |
| <strong>Name</strong>                        | Optional                  | string    | Friendly name |</p>
<h3 id="examples">Examples</h3>
<p>The following are valid egress configuration examples.</p>
<p><strong>Egress data to OCS. All streams, every 15 seconds.</strong></p>
<pre><code class="lang-json">[{
    &quot;Id&quot;: &quot;OCS&quot;,
    &quot;ExecutionPeriod&quot; : &quot;00:00:15&quot;,
    &quot;Endpoint&quot; : &quot; https://{OcsLocation}/api/Tenants/{tenantId}/Namespaces/{namespaceId}/omf&quot;,
    &quot;ClientId&quot; : &quot;{clientId}&quot;,
    &quot;ClientSecret&quot; : &quot;{clientSecret}&quot;
}]
</code></pre><p><strong>Egress data to OCS - streams with a specific TypeId value, every 15 seconds.</strong></p>
<pre><code class="lang-json">[{
    &quot;Id&quot;: &quot;OCS&quot;,
    &quot;ExecutionPeriod&quot; : &quot;00:00:15&quot;,
    &quot;EgressFilter&quot; : &quot;TypeId:myType&quot;,
    &quot;Endpoint&quot; : &quot; https://{OcsLocation}/api/Tenants/{tenantId}/Namespaces/{namespaceId}/omf&quot;,
    &quot;ClientId&quot; : &quot;{clientId}&quot;,
    &quot;ClientSecret&quot; : &quot;{clientSecret}&quot;
}]
</code></pre><p><strong>Egress data to OCS - all streams, every 15 seconds, including backfilling.</strong></p>
<pre><code class="lang-json">[{
    &quot;Id&quot;: &quot;OCS&quot;,
    &quot;ExecutionPeriod&quot; : &quot;00:00:15&quot;,
    &quot;Backfill&quot; : true,
    &quot;Endpoint&quot; : &quot; https://{OcsLocation}/api/Tenants/{tenantId}/Namespaces/{namespaceId}/omf&quot;,
    &quot;ClientId&quot; : &quot;{clientId}&quot;,
    &quot;ClientSecret&quot; : &quot;{clientSecret}&quot;
}]
</code></pre><p><strong>Egress diagnostic data to OCS - every 1 hour.</strong></p>
<pre><code class="lang-json">[{
    &quot;Id&quot;: &quot;OCS&quot;,
    &quot;ExecutionPeriod&quot; : &quot;01:00:00&quot;,
    &quot;Endpoint&quot; : &quot; https://{OcsLocation}/api/Tenants/{tenantId}/Namespaces/{namespaceId}/omf&quot;,
    &quot;ClientId&quot; : &quot;{clientId}&quot;,
    &quot;ClientSecret&quot; : &quot;{clientSecret}&quot;,
    &quot;NamespaceId&quot; : &quot;diagnostics&quot;
}]
</code></pre><p><strong>Egress data to PI - all streams, every 15 seconds, including both type and stream prefix. All properties explicitly listed.</strong></p>
<pre><code class="lang-json">[{
    &quot;Id&quot;: &quot;PI&quot;,
    &quot;Name&quot; : null,
    &quot;Description&quot; : null,
    &quot;ExecutionPeriod&quot; : &quot;00:00:15&quot;,
    &quot;Enabled&quot; : true,
    &quot;Backfill&quot; : false,
    &quot;EgressFilter&quot; : null,
    &quot;Endpoint&quot; : &quot;https://{webApiLocation}/piwebapi/omf/&quot;,
    &quot;ClientId&quot; : null,
    &quot;ClientSecret&quot; : null,
    &quot;Username&quot; : &quot;{username}&quot;,
    &quot;Password&quot; : &quot;{password}&quot;,
    &quot;StreamPrefix&quot; : &quot;1ValidPrefix.&quot;,
    &quot;TypePrefix&quot; : &quot;AlsoValid_&quot;,
    &quot;DebugExpiration&quot; : null,
    &quot;NamespaceId&quot; : &quot;default&quot;,
    &quot;TokenEndpoint&quot; : null,
    &quot;ValidateEndpointCertificate&quot; : true
}]
</code></pre><p><strong>Egress data to PI - streams whose Id contains &quot;Modbus&quot; or &quot;Opc&quot;, every 1 minute.</strong></p>
<pre><code class="lang-json">[{
    &quot;Id&quot;: &quot;PI&quot;,
    &quot;ExecutionPeriod&quot; : &quot;00:01:00&quot;,
    &quot;EgressFilter&quot; : &quot;Id:*Modbus* OR Id:*Opc*&quot;,
    &quot;Endpoint&quot; : &quot;https://{webApiLocation}/piwebapi/omf/&quot;,
    &quot;Username&quot; : &quot;{username}&quot;,
    &quot;Password&quot; : &quot;{password}&quot;
}]
</code></pre><p><strong>Egress data to PI - streams containing a field that begins with &quot;Unique&quot;, every 1 hour.</strong></p>
<pre><code class="lang-json">[{
    &quot;Id&quot;: &quot;PI&quot;,
    &quot;ExecutionPeriod&quot; : &quot;01:00:00&quot;,
    &quot;EgressFilter&quot; : &quot;Unique*&quot;,
    &quot;Endpoint&quot; : &quot;https://{webApiLocation}/piwebapi/omf/&quot;,
    &quot;Username&quot; : &quot;{username}&quot;,
    &quot;Password&quot; : &quot;{password}&quot;
}]
</code></pre><h3 id="rest-urls">REST URLs</h3>
<table>
<thead>
<tr>
<th>Relative URL</th>
<th>HTTP verb</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>api/v1/configuration/storage/periodicegressendpoints</td>
<td>GET</td>
<td>Gets all configured egress endpoints</td>
</tr>
<tr>
<td>api/v1/configuration/storage/periodicegressendpoints</td>
<td>DELETE</td>
<td>Deletes all configured egress endpoints</td>
</tr>
<tr>
<td>api/v1/configuration/storage/periodicegressendpoints</td>
<td>POST</td>
<td>Add an array of egress endpoints, will fail if any endpoint already exists</td>
</tr>
<tr>
<td>api/v1/configuration/storage/periodicegressendpoints</td>
<td>POST</td>
<td>Add a single egress endpoints, will fail if endpoint already exists</td>
</tr>
<tr>
<td>api/v1/configuration/storage/periodicegressendpoints</td>
<td>PUT</td>
<td>Replace all egress endpoints</td>
</tr>
<tr>
<td>api/v1/configuration/storage/periodicegressendpoints/{id}</td>
<td>GET</td>
<td>Get configured endpoint with <em>id</em></td>
</tr>
<tr>
<td>api/v1/configuration/storage/periodicegressendpoints/{id}</td>
<td>DELETE</td>
<td>Delete configured endpoint with <em>id</em></td>
</tr>
<tr>
<td>api/v1/configuration/storage/periodicegressendpoints/{id}</td>
<td>PUT</td>
<td>Replace egress endpoint with <em>id</em>, will fail if endpoint doesn&#39;t exist</td>
</tr>
<tr>
<td>api/v1/configuration/storage/periodicegressendpoints/{id}</td>
<td>PATCH</td>
<td>Allows partial updating of configured endpoint with <em>id</em></td>
</tr>
</tbody>
</table>
<h2 id="egress-execution-details">Egress execution details</h2>
<p>After you add configuration for an egress endpoint, egress execution will periodically occur for that endpoint. Egress is handled individually per configured endpoint. Only the first execution types and containers will be egressed; subsequently only new or changed types/containers will be egressed. <strong>Only streams with a single, timeseries-based index can be egressed</strong>. Type creation must be successful in order to perform container creation; likewise container creation must be successful in order to perform data egress.</p>
<p>Type, container and data items are batched into one or more OMF messages when egressing. Per the requirements defined in OMF, a single message will not exceed 192KB in size. Compression is automatically applied to outbound egress messages. On the destination, failure to add a single item will result in the message failing. In that case the Edge Data Store will fall back to egressing each item individually, per type or stream (that is each type, each stream, all data for a single stream). Types, containers, and data will continue to be egressed as long as the destination continues to respond to HTTP requests - retrying previous failures as needed.</p>
<p>Certain HTTP failures during egress will result in a retry. The Edge Data Store will retry an HTTP request a maximum of five times with exponentially increasing delays between each request. The total time waiting and retrying is currently set at 1 minute. During that time egress of other messages will be delayed. List of retryable occurrences:</p>
<ul>
<li>TimeoutException</li>
<li>HttpRequestException</li>
<li>HttpStatusCode RequestTimeout (408)</li>
<li>HttpStatusCode BadGateway (502)</li>
<li>HttpStatusCode ServiceUnavailable (503)</li>
<li>HttpStatusCode GatewayTimeout (504)</li>
</ul>
<p>For data collection and egress, in-memory and on-disk storage are used to track the last successfully-egressed data event, per stream. Data is egressed in order and includes future events.</p>
<p><strong>Note</strong>  When an event with a future timestamp is successfully egressed, only values after the associated timestamp of that event will be egressed.</p>
<h2 id="destination-preparation">Destination Preparation</h2>
<p>The various OSIsoft OMF destinations may require additional configuration. See details below to prepare an OSIsoft destination to receive OMF messages. </p>
<h3 id="ocs">OCS</h3>
<p>To prepare OCS to receive OMF messages from EDS, add an OMF connection. Creating an OMF connection results in an available OMF endpoint that can be used by the EDS egress mechanism. The basics steps associated with creating an OMF connection are as follows (see OCS documentation for more help):</p>
<ol>
<li>Create a <strong>Client</strong><ul>
<li>The <em>Client Id</em> and <em>Client Secret</em> will be used for the corresponding properties in the egress configuration</li>
</ul>
</li>
<li>Create an <strong>OMF</strong> type <strong>Connection</strong><ul>
<li>The connection should link the created client to an existing namespace where the data will be stored</li>
<li>The <strong>OMF Endpoint</strong> URL for the connection will be used as the egress configuration <em>Endpoint</em> property</li>
</ul>
</li>
</ol>
<h3 id="pi">PI</h3>
<p>To prepare a PI Server to receive OMF messages from EDS, a PI Web API OMF endpoint must be available. The basic steps are as follows (see the PI Web API documentation for complete steps, as well as best practices and recommendations):</p>
<ol>
<li>Install PI Web API and enable the <strong>OSIsoft Messge Format (OMF) Services</strong> feature</li>
<li>Configure PI Web API to use <em>Basic</em> authentication</li>
</ol>
<p><strong>Note</strong>  The certificate used by PI Web API must be trusted by the device running EDS, otherwise the egress configuration <em>ValidateEndpointCertificate</em> property needs to be set to false (this can be the case with a <strong>self-signed certificate</strong> but should only be used for testing purposes).</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/osisoft/Edge-Data-Store-Docs/blob/master/V1/Egress/Egress.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
            <span id='copyright-text'>© 2019 - OSIsoft, LLC.<span>
        </span></span></div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
