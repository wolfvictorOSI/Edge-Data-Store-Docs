<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>OMF quick start </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="OMF quick start ">
    <meta name="generator" content="docfx 2.52.0.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="omfQuickStart1-0">
<h1 id="omf-quick-start">OMF quick start</h1>

<p>Create a custom application using OSIsoft Message Format to send data to Edge Data Store from sources that cannot use Modbus or OPC UA protocols. The following diagram depicts the data flow from an OMF data collection application into EDS:</p>
<p><img src="https://osisoft.github.io/Edge-Data-Store-Docs/V1/images/OMFIngressExample.jpg" alt="EDS OMF Ingress" title="OMF Ingress Example"></p>
<p>The OMF application collects data from a data source and sends it to the EDS endpoint. The EDS endpoint sends the data to the storage component where it is held until it can be egressed to permanent storage in PI Server or OSIsoft Cloud Services. The OMF application must run on the same device as EDS and no authentication is needed. </p>
<p>To get started using OMF messages to ingress data into EDS, create an OMF type and container and then write data events to the container using REST APIs. Use the Sequential Data Store (SDS) REST API to read the data back from EDS.</p>
<h2 id="create-an-omf-type">Create an OMF type</h2>
<p>The first step in OMF data ingress is to create an OMF type that describes the format of the data to be stored in a container. In this example, the data to be written is a timestamp and a numeric value.</p>
<ol>
<li><p>Create an OMF JSON file that defines the type as follows:</p>
<pre><code class="lang-json">[{
    &quot;id&quot;: &quot;MyCustomType&quot;,
    &quot;classification&quot;: &quot;dynamic&quot;,
    &quot;type&quot;: &quot;object&quot;,
    &quot;properties&quot;: {
        &quot;Timestamp&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;format&quot;: &quot;date-time&quot;,
            &quot;isindex&quot;: true
        },
        &quot;Value&quot;: {
            &quot;type&quot;: &quot;number&quot;,
            &quot;format&quot;: &quot;float32&quot;
        }
    }
}]
</code></pre><p>The value is indexed by a timestamp, and the numeric value that will be stored is a 32-bit floating point value.</p>
</li>
<li><p>To create the OMF type in Edge Storage, store the JSON file with the name <em>OmfCreateType.json</em> on the local device.</p>
</li>
<li><p>Run the following curl command:</p>
<pre><code class="lang-bash">curl -d &quot;@OmfCreateType.json&quot; -H &quot;Content-Type: application/json&quot; -H &quot;producertoken: x &quot; -H &quot;omfversion: 1.1&quot; -H &quot;action: create&quot; -H &quot;messageformat: json&quot; -H &quot;messagetype: type&quot; -X POST http://localhost:5590/api/v1/tenants/default/namespaces/default/omf/
</code></pre></li>
</ol>
<p>When this command completes successfully, an OMF type with the same name is created on the server. Any number of containers can be created from the type, as long as they use a timestamp as an index and have a 32-bit floating point value. The create type message needs to be sent first before container and data messages, but it does not cause an error if the same message is sent at a later time.</p>
<h2 id="create-an-omf-container">Create an OMF container</h2>
<p>The next step in writing OMF data is to create an OMF container. As with an OMF type, the create container message only needs to be sent once before sending data events, but resending the same definition again does not cause an error.</p>
<ol>
<li><p>Create an OMF JSON file that defines the container as follows:</p>
<pre><code class="lang-json">[{
    &quot;id&quot;: &quot;MyCustomContainer&quot;,
    &quot;typeid&quot;: &quot;MyCustomType&quot;
}]
</code></pre><p>This container references the OMF type that was created earlier, and an error will occur if the type does not exist when the container is created. </p>
</li>
<li><p>To create the OMF container in Edge Storage, store the JSON file with the name <em>OmfCreateContainer.json</em> on the local device.</p>
</li>
<li><p>To create the SDS stream to store data defined by the type, run the following curl command:</p>
<pre><code class="lang-bash">curl -d &quot;@OmfCreateContainer.json&quot; -H &quot;Content-Type: application/json&quot; -H &quot;producertoken: x &quot; -H &quot;omfversion: 1.1&quot; -H &quot;action: create&quot; -H &quot;messageformat: json&quot; -H &quot;messagetype: container&quot; -X POST http://localhost:5590/api/v1/tenants/default/namespaces/default/omf/
</code></pre></li>
</ol>
<h2 id="write-data-events-to-the-omf-container">Write data events to the OMF container</h2>
<p>Once a type and container are defined, complete the following steps to write data to the container:</p>
<ol>
<li><p>Create an OMF JSON file to define data events to be stored in the SDS Stream created in the previous steps. For best performance, you should batch OMF values together, as in the following example: </p>
<pre><code class="lang-json">[{
    &quot;containerid&quot;: &quot;MyCustomContainer&quot;,
    &quot;values&quot;: [{
            &quot;Timestamp&quot;: &quot;2019-07-16T15:18:24.9870136Z&quot;,
            &quot;Value&quot;: 12345.6789
        },
        {
            &quot;Timestamp&quot;: &quot;2019-07-16T15:18:25.9870136Z&quot;,
            &quot;Value&quot;: 12346.6789
        }
    ]
}]
</code></pre></li>
<li><p>To write the data to EDS, store the JSON file with the name <em>OmfCreateDataEvents.json</em> on the local device.</p>
</li>
<li><p>To write data values to the SDS stream, run the following curl command:</p>
<pre><code class="lang-bash">curl -d &quot;@OmfCreateDataEvents.json&quot; -H &quot;Content-Type: application/json&quot; -H &quot;producertoken: x &quot; -H &quot;omfversion: 1.1&quot; -H &quot;action: create&quot; -H &quot;messageformat: json&quot; -H &quot;messagetype: data&quot; -X POST http://localhost:5590/api/v1/tenants/default/namespaces/default/omf/
</code></pre></li>
</ol>
<h2 id="use-sds-to-read-last-data-written">Use SDS to read last data written</h2>
<p>Use the SDS REST API to read back the last data event written to the server. </p>
<ol>
<li>Start the curl command line tool.</li>
<li><p>Run the following curl command to return the last value written:</p>
<pre><code class="lang-bash">curl http://localhost:5590/api/v1/tenants/default/namespaces/default/streams/MyCustomContainer/Data/Last
</code></pre><p>Sample output:</p>
<pre><code class="lang-json">{&quot;Timestamp&quot;: &quot;2019-07-16T15:18:25.9870136Z&quot;, &quot;Value&quot;: 12346.6789}
</code></pre></li>
</ol>
<h2 id="use-sds-to-read-a-range-of-data-events">Use SDS to read a range of data events</h2>
<p>Use the SDS REST API to read back the a range of data written to the server. </p>
<ol>
<li>Start the curl command line tool.</li>
<li><p>Run the following curl command to return up to 100 values after the startIndex specified:</p>
<pre><code class="lang-bash">curl &quot;http://localhost:5590/api/v1/tenants/default/namespaces/default/streams/MyCustomContainer/Data?startIndex=2017-07-08T13:00:00Z&amp;count=100&quot;
</code></pre><p>Sample output:</p>
<pre><code class="lang-json">[{&quot;Timestamp&quot;: &quot;2019-07-16T15:18:24.9870136Z&quot;,&quot;Value&quot;: 12345.6789}, {&quot;Timestamp&quot;: &quot;2019-07-16T15:18:25.9870136Z&quot;, &quot;Value&quot;: 12346.6789}]
</code></pre><p>Both values that were entered are returned. This command returns up to 100 values after the specified timestamp.</p>
</li>
</ol>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
